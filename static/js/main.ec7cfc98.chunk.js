(this["webpackJsonpagurk-client"]=this["webpackJsonpagurk-client"]||[]).push([[0],{21:function(e,t,n){},25:function(e,t,n){e.exports=n.p+"static/media/logo.25bf045c.svg"},28:function(e,t,n){e.exports=n(45)},33:function(e,t,n){},45:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(14),u=n.n(c),s=(n(33),n(7)),l=n(8),i=n(23),o=n(24),d=n(25),m=n.n(d),p=(n(21),n(10)),E=n(3),y=n(48),f=n(49),T=n(2);function A(e){var t=e.card;return r.a.createElement("div",null,t.kind," ",t.color)}function b(e){var t=e.card;return r.a.createElement("div",null,t.suit," ",t.rank)}function R(e){return e.kind===E.JOKER_CARD_KIND?e.color+e.rank:e.suit+e.rank}function v(e){var t=e.card;return t.kind===E.JOKER_CARD_KIND?r.a.createElement(A,{card:t}):r.a.createElement(b,{card:t})}function S(e){var t=e.cards,n=e.handleSelect,a=t.map((function(e){return r.a.createElement("li",{key:R(e)},r.a.createElement("input",{type:"checkbox",checked:e.isSelected,onChange:function(){return n(e)}}),r.a.createElement(v,{card:e}))}));return r.a.createElement("ul",null,a)}function O(e){var t=e.playSelectedCards;return r.a.createElement("div",null,r.a.createElement("button",{type:"button",onClick:t},"Play Cards"))}function _(e){var t=e.playCards,n=e.cardsInHand,c=e.isServerRequestingCards,u=Object(a.useState)([]),s=Object(p.a)(u,2),l=s[0],i=s[1];return Object(a.useEffect)((function(){var e=n.map((function(e){return Object(T.a)({},e,{isSelected:!1})}));i(e)}),[n]),r.a.createElement("div",null,r.a.createElement("h2",null,"Hand"),r.a.createElement(S,{cards:l,handleSelect:function(e){i(l.map((function(t){return Object(E.cardEquals)(t,e)?Object(T.a)({},t,{isSelected:!t.isSelected}):t})))}}),c&&r.a.createElement(O,{playSelectedCards:function(){var e=l.filter((function(e){return e.isSelected}));t(e)}}))}function h(e){var t=e.player;return r.a.createElement("span",null,t.isServerRequestingCards&&r.a.createElement("span",null,"--\x3e"),t.id)}function g(e){var t=e.players.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(h,{player:e}))}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Players"),r.a.createElement("ul",null,t))}function C(e){var t=e.cards.map((function(e){return r.a.createElement("li",{key:R(e)},r.a.createElement(v,{card:e}))}));return r.a.createElement("ul",null,t)}function N(e){var t=e.playedTurns.filter((function(e){return e.valid})).flatMap((function(e){return e.cards}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Stack"),r.a.createElement(C,{cards:t}))}var j=Object(s.b)((function(e,t){return{cardsInHand:e.game.cardsInHand,players:e.game.players,playedTurns:e.game.validatedTurns,playerState:e.game.players.find((function(t){return t.id===e.game.playerId})),playCards:function(e){return t.serverApi.sendPlayCards(e)}}}))((function(e){var t=e.players,n=e.playedTurns,a=e.cardsInHand,c=e.playCards,u=e.playerState;return r.a.createElement("div",null,r.a.createElement(g,{players:t}),r.a.createElement(N,{playedTurns:n}),r.a.createElement(_,{isServerRequestingCards:u.isServerRequestingCards,cardsInHand:a,playCards:c}))})),I=n(15),D={isRunning:!1,playerId:void 0,players:[],validatedTurns:[],cardsInHand:[]},k={isGameWinner:!1,isRoundWinner:!1,isCycleHighestTurnPlayer:!1,penalties:[],isOut:!1,isServerRequestingCards:!1};function P(e,t){return e.filter((function(e){return e.playerId===t}))}function M(e,t){return e.some((function(e){return e.id===t}))}function H(e,t){return e.some((function(e){return e===t}))}function L(e,t){return e.filter((function(e){return void 0===t.cards.find((function(t){return Object(E.cardEquals)(e,t)}))}))}var w={players:[]};function U(e){return e.next({name:E.MessageName.START_GAME})}function Y(e,t){return e.next({name:E.MessageName.PLAY_CARDS,data:t})}function B(e,t){return e.next({name:E.MessageName.AUTHENTICATE,data:t})}function G(e){var t=e.playerIds.map((function(e){return r.a.createElement("li",{key:e},e)}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Players"),r.a.createElement("ul",null,t))}var x=Object(s.b)((function(e){return{isGameStarted:e.game.isRunning,players:e.lobby.players,authenticationToken:e.authentication.token}}))((function(e){var t=e.dispatch,n=e.authenticationToken,c=e.isGameStarted,u=e.players,s=Object(a.useState)(Object(f.a)("wss://agurk-server.herokuapp.com")),l=Object(p.a)(s,1)[0],i=function(e){return{sendStartGame:U.bind(null,e),sendPlayCards:Y.bind(null,e)}}(l);return Object(a.useEffect)((function(){return l.subscribe((function(e){return function(e,t){switch(e.name){case E.MessageName.BROADCAST_LOBBY_PLAYERS:return t({type:"SET_LOBBY_PLAYERS",playerIds:e.data});case E.MessageName.BROADCAST_START_GAME:return t(function(e){return{type:"START_GAME",playerIds:e}}(e.data.players));case E.MessageName.BROADCAST_END_GAME:return e.data.isValid?t({type:"END_GAME_SUCCESS",winner:e.data.winner}):t({type:"END_GAME_ERROR",error:e.data.error}),t({type:"RESET_GAME"});case E.MessageName.BROADCAST_START_ROUND:return t(function(e){return{type:"START_ROUND",playerIds:e}}(e.data.players));case E.MessageName.BROADCAST_END_ROUND:return t(function(e,t,n){return{type:"END_ROUND",winner:e,penalties:t,outPlayers:n}}(e.data.winner,e.data.penalties,e.data.outPlayers));case E.MessageName.BROADCAST_START_CYCLE:return t({type:"START_CYCLE",orderedPlayerIds:e.data.orderedPlayers});case E.MessageName.BROADCAST_END_CYCLE:return t((n=e.data.outPlayers,{type:"END_CYCLE",highestTurnPlayerIds:e.data.highestTurnPlayers,outPlayers:n}));case E.MessageName.BROADCAST_PLAYER_TURN:return t({type:"ADD_PLAYER_TURN",turn:e.data});case E.MessageName.AVAILABLE_CARDS_IN_HAND:return t({type:"SET_CARDS_IN_HAND",cards:e.data});case E.MessageName.REQUEST_CARDS:return t({type:"REQUEST_CARDS"});case E.MessageName.BROADCAST_START_PLAYER_TURN:return t({type:"START_PLAYER_TURN",playerId:e.data})}var n}(e,t)})),function(){return l.complete()}}),[l,t]),Object(a.useEffect)((function(){return l.pipe(Object(y.a)((function(e){return e.name===E.MessageName.REQUEST_AUTHENTICATION}))).subscribe((function(){(function(e){return{sendAuthenticate:B.bind(null,e)}})(l).sendAuthenticate(n)})),function(){return l.complete()}}),[l,n]),r.a.createElement("div",{className:"Lobby"},c?r.a.createElement(j,{serverApi:i}):r.a.createElement(r.a.Fragment,null,r.a.createElement(G,{playerIds:u}),r.a.createElement("button",{type:"button",onClick:i.sendStartGame},"Start Game")))})),q=n(19),W=n.n(q),K=n(26),J=n(27),Q=n.n(J),F={subject:"",isAuthenticated:!1,token:"",error:void 0};function V(e,t){return{type:"AUTHENTICATE_WITH_TOKEN",token:e,subject:t}}function $(e){return{type:"AUTHENTICATION_ERROR",message:e}}function z(e){return Q()(e).sub}var X=Object(s.b)((function(e){return{error:e.authentication.error}}))((function(e){var t=e.dispatch,n=e.error,c=Object(a.useState)(""),u=Object(p.a)(c,2),s=u[0],l=u[1],i=Object(a.useState)(""),o=Object(p.a)(i,2),d=o[0],m=o[1];return r.a.createElement("div",null,r.a.createElement("h2",null,"Login"),r.a.createElement("form",{onSubmit:function(e){var n;t((n={name:s,token:d},function(e){fetch("".concat("https://agurk-server.herokuapp.com","/authenticate"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)}).then(function(){var t=Object(K.a)(W.a.mark((function t(n){var a,r,c;return W.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n.ok){t.next=10;break}return t.next=3,n.json();case 3:a=t.sent,r=a.jwt,c=z(a.jwt),e(V(r,c)),e({type:"SET_PLAYER_ID",playerId:c}),t.next=11;break;case 10:e($("Authentication failed"));case 11:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),(function(){return e($("Could not contact server. Try again later..."))}))})),e.preventDefault()}},r.a.createElement("label",{htmlFor:"name"},"Player name",r.a.createElement("input",{id:"name",value:s,onChange:function(e){l(e.currentTarget.value)},type:"text",name:"name",required:!0})),r.a.createElement("br",null),r.a.createElement("label",{htmlFor:"token"},"Access token",r.a.createElement("input",{id:"token",value:d,onChange:function(e){m(e.currentTarget.value)},type:"text",name:"token",required:!0})),r.a.createElement("br",null),r.a.createElement("input",{type:"submit",value:"Submit"})),n&&r.a.createElement("p",null,n))}));var Z=Object(s.b)((function(e){return{isAuthenticated:e.authentication.isAuthenticated}}))((function(e){var t=e.isAuthenticated;return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:m.a,className:"App-logo",alt:"logo"})),r.a.createElement("main",null,r.a.createElement("h1",null,"Agurk"),t?r.a.createElement(x,null):r.a.createElement(X,null)))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ee=Object(l.combineReducers)({authentication:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:F,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"AUTHENTICATE_WITH_TOKEN":return Object(T.a)({},e,{subject:t.subject,isAuthenticated:!0,token:t.token,error:void 0});case"AUTHENTICATION_ERROR":return Object(T.a)({},e,{error:t.message});default:return e}},game:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:D,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_PLAYER_ID":return Object(T.a)({},e,{playerId:t.playerId});case"START_GAME":return Object(T.a)({},e,{isRunning:!0,players:t.playerIds.map((function(e){return Object(T.a)({},k,{id:e})}))});case"END_GAME_SUCCESS":return Object(T.a)({},e,{players:e.players.map((function(e){return Object(T.a)({},e,{isGameWinner:e.id===t.winner,isServerRequestingCards:!1})})),validatedTurns:[],cardsInHand:[]});case"RESET_GAME":return Object(T.a)({},e,{validatedTurns:[],players:e.players.map((function(e){return Object(T.a)({},e,{isServerRequestingCards:!1})})),cardsInHand:[],isRunning:!1});case"END_GAME_ERROR":return e;case"SET_CARDS_IN_HAND":return Object(T.a)({},e,{cardsInHand:t.cards});case"ADD_PLAYER_TURN":return Object(T.a)({},e,{validatedTurns:[].concat(Object(I.a)(e.validatedTurns),[t.turn]),cardsInHand:t.turn.playerId===e.playerId&&t.turn.valid?L(e.cardsInHand,t.turn):e.cardsInHand});case"START_ROUND":return e;case"END_ROUND":return Object(T.a)({},e,{players:e.players.map((function(e){return Object(T.a)({},e,{penalties:[].concat(Object(I.a)(e.penalties),Object(I.a)(P(t.penalties,e.id))),isOut:M(t.outPlayers,e.id),isRoundWinner:e.id===t.winner})}))});case"START_CYCLE":return Object(T.a)({},e,{validatedTurns:[]});case"END_CYCLE":return Object(T.a)({},e,{players:e.players.map((function(e){return Object(T.a)({},e,{isCycleHighestTurnPlayer:H(t.highestTurnPlayerIds,e.id),isOut:M(t.outPlayers,e.id)})}))});case"REQUEST_CARDS":return e;case"START_PLAYER_TURN":return Object(T.a)({},e,{players:e.players.map((function(e){return Object(T.a)({},e,{isServerRequestingCards:t.playerId===e.id})}))});default:return e}},lobby:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:w,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"SET_LOBBY_PLAYERS":return Object(T.a)({},e,{players:t.playerIds});default:return e}}}),te=Object(l.createStore)(ee,Object(o.composeWithDevTools)(Object(l.applyMiddleware)(i.a)));u.a.render(r.a.createElement(s.a,{store:te},r.a.createElement(Z,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[28,1,2]]]);
//# sourceMappingURL=main.ec7cfc98.chunk.js.map