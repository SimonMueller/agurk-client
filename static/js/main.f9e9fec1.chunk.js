(this["webpackJsonpagurk-client"]=this["webpackJsonpagurk-client"]||[]).push([[0],{33:function(e,t,a){},35:function(e,t,a){e.exports=a.p+"static/media/logo.25bf045c.svg"},39:function(e,t,a){e.exports=a(53)},44:function(e,t,a){},53:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(21),u=a.n(c),i=(a(44),a(11)),s=a(24),l=a(23),o=a(13),d=a(35),m=a.n(d),E=(a(33),a(15)),p=a(3),f=a(56),A=a(57),y=a(4);function T(e){var t=e.card;return r.a.createElement("div",null,t.kind," ",t.color)}function b(e){var t=e.card;return r.a.createElement("div",null,t.suit," ",t.rank)}function h(e){return e.kind===p.JOKER_CARD_KIND?e.color+e.rank:e.suit+e.rank}function v(e){var t=e.card;return t.kind===p.JOKER_CARD_KIND?r.a.createElement(T,{card:t}):r.a.createElement(b,{card:t})}function O(e){var t=e.cards,a=e.handleSelect,n=t.map((function(e){return r.a.createElement("li",{key:h(e)},r.a.createElement("input",{type:"checkbox",checked:e.isSelected,onChange:function(){return a(e)}}),r.a.createElement(v,{card:e}))}));return r.a.createElement("ul",null,n)}function R(e){var t=e.playSelectedCards;return r.a.createElement("div",null,r.a.createElement("button",{type:"button",onClick:t},"Play Cards"))}function S(e){var t=e.playCards,a=e.cardsInHand,c=Object(n.useState)([]),u=Object(E.a)(c,2),i=u[0],s=u[1];return Object(n.useEffect)((function(){var e=a.map((function(e){return Object(y.a)({},e,{isSelected:!1})}));s(e)}),[a]),r.a.createElement("div",null,r.a.createElement("h2",null,"Hand"),r.a.createElement(O,{cards:i,handleSelect:function(e){s(i.map((function(t){return Object(p.cardEquals)(t,e)?Object(y.a)({},t,{isSelected:!t.isSelected}):t})))}}),r.a.createElement(R,{playSelectedCards:function(){var e=i.filter((function(e){return e.isSelected}));t(e)}}))}function _(e){var t=e.player;return r.a.createElement("div",null,r.a.createElement("p",null,t.isServerRequestingCards&&r.a.createElement("span",null,"--\x3e"),t.id))}function C(e){var t=e.players.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(_,{player:e}))}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Players"),r.a.createElement("ul",null,t))}function N(e){var t=e.cards.map((function(e){return r.a.createElement("li",{key:h(e)},r.a.createElement(v,{card:e}))}));return r.a.createElement("ul",null,t)}function j(e){var t=e.playedTurns.filter((function(e){return e.valid})).flatMap((function(e){return e.cards}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Stack"),r.a.createElement(N,{cards:t}))}var g=Object(i.b)((function(e,t){return{playCards:t.serverApi.sendPlayCards,startGame:t.serverApi.sendStartGame,cardsInHand:e.cardsInHand,players:e.players,playedTurns:e.validatedTurns}}))((function(e){var t=e.players,a=e.playedTurns,n=e.cardsInHand,c=e.playCards,u=e.startGame;return r.a.createElement("div",null,r.a.createElement("h1",null,"Agurk"),r.a.createElement("button",{type:"button",onClick:u},"Start Game"),r.a.createElement(C,{players:t}),r.a.createElement(j,{playedTurns:a}),r.a.createElement(S,{cardsInHand:n,playCards:c}))}));function D(e){return e.next({name:p.MessageName.START_GAME})}function k(e,t){return e.next({name:p.MessageName.PLAY_CARDS,data:t})}function I(e,t){return e.next({name:p.MessageName.AUTHENTICATE,data:t})}function M(e){return{sendStartGame:D.bind(null,e),sendPlayCards:k.bind(null,e)}}var P=Object(i.b)((function(e){return{authenticationToken:e.authentication.jwt}}))((function(e){var t=e.dispatch,a=e.authenticationToken,c=Object(n.useState)(Object(A.a)("wss://agurk-server.herokuapp.com/")),u=Object(E.a)(c,1)[0];return Object(n.useEffect)((function(){return u.subscribe((function(e){return function(e,t){switch(e.name){case p.MessageName.BROADCAST_START_GAME:return t({type:"START_GAME",playerIds:e.data.players});case p.MessageName.BROADCAST_END_GAME:return e.data.isValid?t({type:"END_GAME_SUCCESS",winner:e.data.winner}):t({type:"END_GAME_ERROR",error:e.data.error}),t({type:"RESET_GAME"});case p.MessageName.BROADCAST_START_ROUND:return t(function(e){return{type:"START_ROUND",playerIds:e}}(e.data.players));case p.MessageName.BROADCAST_END_ROUND:return t(function(e,t,a){return{type:"END_ROUND",winner:e,penalties:t,outPlayers:a}}(e.data.winner,e.data.penalties,e.data.outPlayers));case p.MessageName.BROADCAST_START_CYCLE:return t({type:"START_CYCLE",orderedPlayerIds:e.data.orderedPlayers});case p.MessageName.BROADCAST_END_CYCLE:return t((a=e.data.outPlayers,{type:"END_CYCLE",highestTurnPlayerIds:e.data.highestTurnPlayers,outPlayers:a}));case p.MessageName.BROADCAST_PLAYER_TURN:return t({type:"ADD_PLAYER_TURN",turn:e.data});case p.MessageName.AVAILABLE_CARDS_IN_HAND:return t({type:"SET_CARDS_IN_HAND",cards:e.data});case p.MessageName.REQUEST_CARDS:return t({type:"REQUEST_CARDS"});case p.MessageName.BROADCAST_START_PLAYER_TURN:return t({type:"START_PLAYER_TURN",playerId:e.data})}var a}(e,t)})),function(){return u.complete()}}),[u,t]),Object(n.useEffect)((function(){return u.pipe(Object(f.a)((function(e){return e.name===p.MessageName.REQUEST_AUTHENTICATION}))).subscribe((function(){(function(e){return{sendAuthenticate:I.bind(null,e)}})(u).sendAuthenticate(a)})),function(){return u.complete()}}),[u,a]),r.a.createElement("div",{className:"Lobby"},r.a.createElement(g,{serverApi:M(u)}))})),w=a(38);var H=Object(i.b)((function(e){return{isAuthenticated:e.authentication.isAuthenticated}}))((function(e){var t=e.children,a=e.isAuthenticated,n=Object(w.a)(e,["children","isAuthenticated"]);return(r.a.createElement(o.b,n,a?t:r.a.createElement(o.a,{to:"/"})))})),U=a(30),G=a.n(U),L=a(37);var x=Object(i.b)((function(e){return{isAuthenticated:e.authentication.isAuthenticated}}),(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE_WITH_TOKEN",jwt:t})}}}))((function(e){var t=e.isAuthenticated,a=e.authenticate,c=Object(n.useState)(""),u=Object(E.a)(c,2),i=u[0],s=u[1],l=Object(n.useState)(""),d=Object(E.a)(l,2),m=d[0],p=d[1];function f(){return(f=Object(L.a)(G.a.mark((function e(t){var n,r;return G.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.preventDefault(),e.prev=1,e.next=4,fetch("".concat("https://agurk-server.herokuapp.com/","/authenticate"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:i,token:m})});case 4:if(!(n=e.sent).ok){e.next=10;break}return e.next=8,n.json();case 8:r=e.sent,a(r.jwt);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(1),console.error(e.t0);case 15:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("h1",null,"Home"),r.a.createElement("form",{onSubmit:function(e){return f.apply(this,arguments)}},r.a.createElement("label",{htmlFor:"name"},"Player name:",r.a.createElement("input",{id:"name",value:i,onChange:function(e){s(e.currentTarget.value)},type:"text",name:"name"})),r.a.createElement("label",{htmlFor:"token"},"Access token",r.a.createElement("input",{id:"token",value:m,onChange:function(e){p(e.currentTarget.value)},type:"text",name:"token"})),r.a.createElement("input",{type:"submit",value:"Submit"})),t&&r.a.createElement(o.a,{to:"/lobby"}))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Y=a(25),B={authentication:{isAuthenticated:!1,jwt:""},isGameFinished:!1,players:[],validatedTurns:[],cardsInHand:[]},W={isGameWinner:!1,isRoundWinner:!1,isCycleHighestTurnPlayer:!1,penalties:[],isOut:!1,isServerRequestingCards:!1};function q(e,t){return e.filter((function(e){return e.playerId===t}))}function K(e,t){return e.some((function(e){return e.id===t}))}function F(e,t){return e.some((function(e){return e===t}))}var J=Object(s.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:B,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GAME":return Object(y.a)({},e,{players:t.playerIds.map((function(e){return Object(y.a)({},W,{id:e})}))});case"END_GAME_SUCCESS":return Object(y.a)({},e,{isGameFinished:!0,players:e.players.map((function(e){return Object(y.a)({},e,{isGameWinner:e.id===t.winner,isServerRequestingCards:!1})})),cardsInHand:[],validatedTurns:[]});case"RESET_GAME":return Object(y.a)({},e,{cardsInHand:[],validatedTurns:[],players:e.players.map((function(e){return Object(y.a)({},e,{isServerRequestingCards:!1})}))});case"END_GAME_ERROR":return Object(y.a)({},e,{isGameFinished:!0});case"SET_CARDS_IN_HAND":return Object(y.a)({},e,{cardsInHand:t.cards});case"ADD_PLAYER_TURN":return Object(y.a)({},e,{validatedTurns:[].concat(Object(Y.a)(e.validatedTurns),[t.turn])});case"START_ROUND":return e;case"END_ROUND":return Object(y.a)({},e,{players:e.players.map((function(e){return Object(y.a)({},e,{penalties:[].concat(Object(Y.a)(e.penalties),Object(Y.a)(q(t.penalties,e.id))),isOut:K(t.outPlayers,e.id),isRoundWinner:e.id===t.winner})}))});case"START_CYCLE":return Object(y.a)({},e,{validatedTurns:[]});case"END_CYCLE":return Object(y.a)({},e,{players:e.players.map((function(e){return Object(y.a)({},e,{isCycleHighestTurnPlayer:F(t.highestTurnPlayerIds,e.id),isOut:K(t.outPlayers,e.id)})}))});case"REQUEST_CARDS":return e;case"AUTHENTICATE_WITH_TOKEN":return Object(y.a)({},e,{authentication:{isAuthenticated:!0,jwt:t.jwt}});case"START_PLAYER_TURN":return Object(y.a)({},e,{players:e.players.map((function(e){return Object(y.a)({},e,{isServerRequestingCards:t.playerId===e.id})}))});default:return e}}));u.a.render(r.a.createElement(i.a,{store:J},r.a.createElement((function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:m.a,className:"App-logo",alt:"logo"})),r.a.createElement("main",null,r.a.createElement(l.a,null,r.a.createElement(o.d,null,r.a.createElement(H,{path:"/game"},r.a.createElement(P,null)),r.a.createElement(o.b,{path:"/"},r.a.createElement(x,null))))))}),null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[39,1,2]]]);
//# sourceMappingURL=main.f9e9fec1.chunk.js.map