{"version":3,"sources":["styled/Button.tsx","PlayingCard.tsx","SelectableCardList.tsx","TextSecondTimer.tsx","Hand.tsx","styled/Badge.tsx","Player.tsx","PlayerStateList.tsx","Turn.tsx","TurnList.tsx","Stack.tsx","redux/game.ts","Protocol.tsx","Game.tsx","redux/lobby.ts","communication/webSocketServerApi.ts","PlayerIdList.tsx","redux/authentication.ts","Lobby.tsx","Login.tsx","App.tsx","serviceWorker.ts","redux/index.ts","styled/theme.ts","index.tsx"],"names":["styled","button","theme","colors","primary","CardRankText","p","CardAttributeText","Card","div","isSelected","text","CardPlaceholder","generateCardKey","card","kind","JOKER_CARD_KIND","color","rank","suit","JokerCard","SuitCard","PlayingCard","PlayingCardPlaceholder","Flex","Box","UnstyledButton","CardList","cards","handleSelect","cardItems","map","key","onClick","TextSecondTimer","timeoutInSeconds","useState","timeLeftInSeconds","setTimeLeftInSeconds","useEffect","interval","setInterval","clearInterval","MutedParagraph","muted","PlayTurn","handlePlayClick","turnTimeoutInMillis","turnRetriesLeft","type","Hand","playCards","cardsInHand","isServerRequestingCards","selectableCards","setSelectableCards","clicked","cardEquals","selectedCards","filter","span","PenaltyBadge","Badge","warn","opacityPulse","keyframes","PlayerName","props","isOut","ActivePlayerName","InactivePlayerName","Player","player","penaltySum","penalties","reduce","accumulator","current","id","Li","li","PlayerStateList","playerItems","players","MutedFlex","CardBox","Centered","TurnBox","ErrorBadge","error","generateTurnKey","turn","playerId","valid","Valid","InvalidHiddenAfterTimeout","isVisible","setIsVisible","timeout","setTimeout","clearTimeout","length","invalidReason","Turn","TurnList","turnItems","turns","SuccessBadge","success","LastPlayedMaxCard","playedCards","playedTurns","flatMap","highestPlayedCard","maxRankCard","currentCard","compareRanks","Stack","filterPenaltiesForPlayerId","penalty","isPlayerWithIdOut","outPlayers","some","outPlayer","isPlayerIdOneOfHighestTurnPlayers","highestTurnPlayerIds","highestTurnPlayerId","filterAvailableCardsAfterTurn","cardInHand","undefined","find","turnCard","INITIAL_STATE","isRunning","validatedTurns","protocol","INITIAL_PLAYER_STATE","isGameWinner","isRoundWinner","isCycleHighestTurnPlayer","Protocol","entryItems","entries","entry","message","connect","state","ownProps","game","playerState","serverApi","sendPlayCards","protocolEntries","dispatch","reset","sendStartGame","subject","next","name","MessageName","START_GAME","PLAY_CARDS","data","sendAuthenticate","token","AUTHENTICATE","Element","PlayerIdList","playerIds","authenticateWithToken","authenticationError","extractSubjectFromToken","jwtDecode","sub","isAuthenticated","isGameStarted","lobby","authenticationToken","authentication","webSocket","process","gameApi","bind","createGameApi","subscribe","BROADCAST_LOBBY_PLAYERS","BROADCAST_START_GAME","startGame","BROADCAST_END_GAME","isValid","winner","BROADCAST_START_ROUND","startRound","BROADCAST_END_ROUND","endRound","BROADCAST_START_CYCLE","orderedPlayerIds","orderedPlayers","BROADCAST_END_CYCLE","highestTurnPlayers","BROADCAST_PLAYER_TURN","AVAILABLE_CARDS_IN_HAND","REQUEST_CARDS","timeoutInMillis","retriesLeft","BROADCAST_START_PLAYER_TURN","dispatchWebSocketMessageAsActions","complete","pipe","REQUEST_AUTHENTICATION","createAuthenticationApi","className","Input","input","SpacedForm","form","ErrorMessage","nameInput","setNameInput","tokenInput","setTokenInput","onSubmit","event","fetch","method","mode","headers","body","JSON","stringify","then","response","a","ok","json","jwt","preventDefault","placeholder","value","onChange","currentTarget","required","Container","Footer","footer","Main","main","MutedLink","href","Boolean","window","location","hostname","match","combineReducers","action","join","Date","toString","Math","random","store","createStore","reducer","composeWithDevTools","applyMiddleware","thunk","ReactDOM","render","document","getElementById","navigator","serviceWorker","ready","registration","unregister"],"mappings":"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","file":"static/js/main.41a2e7ae.chunk.js","sourcesContent":["import styled from 'styled-components';\nimport { Theme } from './theme';\n\nexport default styled.button`\n  display: inline-block;\n  font-size: 1em;\n  height: 3em;\n  padding: 0.75em;\n  width: 100%;\n  background-color: transparent;\n  border: 2px solid ${({ theme }: { theme: Theme }) => (theme.colors.primary)};\n  font-weight: bold;\n  color: ${({ theme }: { theme: Theme }) => (theme.colors.primary)};\n\n  &:hover {\n    background-color: ${({ theme }: { theme: Theme }) => (theme.colors.primary)};\n    color: white;\n    cursor: pointer;\n  }\n`;\n","import React from 'react';\nimport {\n  Card as CardData, JOKER_CARD_KIND, JokerCard as JokerCardData, SuitCard as SuitCardData,\n} from 'agurk-shared';\nimport styled from 'styled-components';\nimport { Theme } from './styled/theme';\n\ninterface PlayingCardProps {\n  card: CardData;\n  isSelected?: boolean;\n}\n\ninterface JokerCardProps {\n  card: JokerCardData;\n}\n\ninterface SuitCardProps {\n  card: SuitCardData;\n}\n\nconst CardRankText = styled.p`\n  font-weight: bold;\n  flex-basis: 100%;\n  text-align: center;\n  display: block;\n  font-size: 3em;\n  margin: 0;\n`;\n\nconst CardAttributeText = styled.p`\n  font-weight: bold;\n  flex-basis: 100%;\n  text-align: center;\n  display: block;\n  font-size: 0.7em;\n  margin: 0;\n`;\n\nconst Card = styled.div`\n  color: ${({ isSelected, theme }: { isSelected: boolean, theme: Theme }) => (\n    isSelected ? `${theme.colors.primary}` : ` ${theme.colors.text}`\n  )};\n  border: 1px solid;\n  border-radius: 4px;\n  width: 4.5em;\n  height: 7em;\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n  align-items: center;\n  margin: auto;\n`;\n\nconst CardPlaceholder = styled(Card)`\n  border: ${({ theme }: { theme: Theme }) => (`1px dotted ${theme.colors.text}`)};\n`;\n\nexport function generateCardKey(card: CardData): string {\n  if (card.kind === JOKER_CARD_KIND) {\n    return card.color + card.rank;\n  }\n  return card.suit + card.rank;\n}\n\nfunction JokerCard({ card }: JokerCardProps) {\n  return (\n    <>\n      <CardRankText>\n        J\n      </CardRankText>\n      <CardAttributeText>\n        { card.color }\n      </CardAttributeText>\n    </>\n  );\n}\n\nfunction SuitCard({ card }: SuitCardProps) {\n  return (\n    <>\n      <CardRankText>\n        { card.rank }\n      </CardRankText>\n      <CardAttributeText>\n        { card.suit }\n      </CardAttributeText>\n    </>\n  );\n}\n\nexport default function PlayingCard({ card, isSelected = false }: PlayingCardProps) {\n  return (\n    <Card isSelected={isSelected}>\n      { card.kind === JOKER_CARD_KIND\n        ? <JokerCard card={card} />\n        : <SuitCard card={card} /> }\n    </Card>\n  );\n}\n\nexport function PlayingCardPlaceholder() {\n  return (\n    <CardPlaceholder isSelected={false} />\n  );\n}\n","import React from 'react';\nimport { Card as CardData } from 'agurk-shared';\nimport styled from 'styled-components';\nimport PlayingCard, { generateCardKey } from './PlayingCard';\n\nexport type SelectableCard = CardData & { isSelected: boolean };\n\ninterface Props {\n  cards: SelectableCard[];\n  handleSelect: (card: CardData) => void;\n}\n\nconst Flex = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  margin-bottom: 1em;\n  justify-content: center;\n`;\n\nconst Box = styled.div`\n  margin-right: 0.5em;\n  margin-bottom: 0.5em;\n`;\n\nconst UnstyledButton = styled.button`\n  all: unset;\n  cursor: pointer;\n`;\n\nexport default function CardList({ cards, handleSelect }: Props) {\n  const cardItems = cards.map((card) => (\n    <Box key={generateCardKey(card)}>\n      <UnstyledButton onClick={() => handleSelect(card)}>\n        <PlayingCard card={card} isSelected={card.isSelected} />\n      </UnstyledButton>\n    </Box>\n  ));\n\n  return (\n    <Flex>\n      { cardItems }\n    </Flex>\n  );\n}\n","import React, { useEffect, useState } from 'react';\n\ninterface Props {\n  timeoutInSeconds: number;\n}\n\nexport default function TextSecondTimer({ timeoutInSeconds }: Props) {\n  const [timeLeftInSeconds, setTimeLeftInSeconds] = useState<number>(timeoutInSeconds);\n\n  useEffect(() => {\n    const interval: number = setInterval(() => {\n      const newTimeLeftInMillis = timeLeftInSeconds - 1;\n      return newTimeLeftInMillis < 0\n        ? clearInterval(interval)\n        : setTimeLeftInSeconds(timeLeftInSeconds - 1);\n    }, 1000);\n    return () => clearInterval(interval);\n  });\n\n  return (<>{ timeLeftInSeconds }</>);\n}\n","import React, { useEffect, useState } from 'react';\nimport { Card, cardEquals } from 'agurk-shared';\nimport styled from 'styled-components';\nimport SelectableCardList, { SelectableCard } from './SelectableCardList';\nimport PrimaryButton from './styled/Button';\nimport TextSecondTimer from './TextSecondTimer';\nimport { Theme } from './styled/theme';\n\ninterface Props {\n  playCards: (cards: Card[]) => void;\n  cardsInHand: Card[];\n  isServerRequestingCards: boolean;\n  turnTimeoutInMillis: number | undefined;\n  turnRetriesLeft: number;\n}\n\ninterface PlayTurnProps {\n  handlePlayClick: () => void;\n  turnTimeoutInMillis: number | undefined;\n  turnRetriesLeft: number;\n}\n\nconst MutedParagraph = styled.p`\n  color: ${({ theme }: { theme: Theme }) => (theme.colors.muted)};\n  text-align: center;\n`;\n\nfunction PlayTurn({ handlePlayClick, turnTimeoutInMillis, turnRetriesLeft }: PlayTurnProps) {\n  return (\n    <>\n      <PrimaryButton type=\"button\" onClick={handlePlayClick}>\n      Play Cards\n        { ' ' }\n        { turnTimeoutInMillis && (\n        <span>\n          (\n          <TextSecondTimer timeoutInSeconds={turnTimeoutInMillis / 1000} />\n          )\n        </span>\n        ) }\n      </PrimaryButton>\n\n      <MutedParagraph>\n        { turnRetriesLeft }\n        { ' ' }\n        { turnRetriesLeft === 1\n          ? 'Retry left'\n          : 'Retries left' }\n      </MutedParagraph>\n    </>\n  );\n}\n\nexport default function Hand({\n  playCards, cardsInHand, isServerRequestingCards, turnTimeoutInMillis, turnRetriesLeft,\n}: Props) {\n  const [selectableCards, setSelectableCards] = useState<SelectableCard[]>([]);\n\n  useEffect(() => {\n    const cards = cardsInHand.map((card) => ({ ...card, isSelected: false }));\n    setSelectableCards(cards);\n  }, [cardsInHand]);\n\n  function playSelectedCards() {\n    const selectedCards = selectableCards.filter((card) => card.isSelected);\n    playCards(selectedCards);\n  }\n\n  function handleCardSelect(clicked: Card) {\n    setSelectableCards(selectableCards.map((card) => (cardEquals(card, clicked)\n      ? { ...card, isSelected: !card.isSelected }\n      : card)));\n  }\n\n  return (\n    <div>\n      <h2>Hand</h2>\n\n      <SelectableCardList cards={selectableCards} handleSelect={handleCardSelect} />\n\n      { isServerRequestingCards\n        && (\n          <PlayTurn\n            handlePlayClick={playSelectedCards}\n            turnTimeoutInMillis={turnTimeoutInMillis}\n            turnRetriesLeft={turnRetriesLeft}\n          />\n        )}\n    </div>\n  );\n}\n","import styled from 'styled-components';\n\nexport default styled.span`\n  background-color: transparent;\n  border-radius: 0.25em;\n  font-size: 0.7em;\n  margin: 0 0.5em;\n  padding: 0.15em 0.25em;\n  font-weight: bold;\n  text-transform: uppercase;\n`;\n","import React from 'react';\nimport styled, { keyframes } from 'styled-components';\nimport { PlayerState } from './redux/game';\nimport Badge from './styled/Badge';\nimport { Theme } from './styled/theme';\n\ninterface Props {\n  player: PlayerState;\n}\n\nexport const PenaltyBadge = styled(Badge)`\n  background-color: ${({ theme }: { theme: Theme }) => (theme.colors.warn)};\n  color: white;\n`;\n\nconst opacityPulse = keyframes`\n  0% {\n    opacity: 0.6;\n  }\n\n  50% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0.6;\n  }\n`;\n\nconst PlayerName = styled.span`\n  text-decoration-line: ${(props: { isOut: boolean }) => (props.isOut ? 'line-through' : 'none')};\n`;\n\nconst ActivePlayerName = styled(PlayerName)`\n  animation: ${opacityPulse} 2s infinite;\n  font-weight: bold;\n`;\n\nconst InactivePlayerName = styled(PlayerName)`\n  font-weight: normal;\n`;\n\nexport default function Player({ player }: Props) {\n  const penaltySum = player.penalties.reduce((accumulator, current) => current.card.rank + accumulator, 0);\n\n  return (\n    <>\n      { player.isServerRequestingCards\n        ? <ActivePlayerName isOut={player.isOut}>{ player.id }</ActivePlayerName>\n        : <InactivePlayerName isOut={player.isOut}>{ player.id }</InactivePlayerName>}\n      <PenaltyBadge>\n        Penalty\n        {' '}\n        {penaltySum}\n      </PenaltyBadge>\n    </>\n  );\n}\n","import React from 'react';\nimport styled from 'styled-components';\nimport Player from './Player';\nimport { PlayerState } from './redux/game';\n\ninterface Props {\n  players: PlayerState[];\n}\n\nconst Li = styled.li`\n  margin-bottom: 0.5em;\n`;\n\nexport default function PlayerStateList({ players }: Props) {\n  const playerItems = players.map((player) => <Li key={player.id}><Player player={player} /></Li>);\n\n  return (\n    <div>\n      <h2>Players</h2>\n\n      <ul>\n        { playerItems }\n      </ul>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport styled from 'styled-components';\nimport { InvalidTurn, ValidatedTurn, ValidTurn } from 'agurk-shared';\nimport PlayingCard, { generateCardKey, PlayingCardPlaceholder } from './PlayingCard';\nimport Badge from './styled/Badge';\nimport { Theme } from './styled/theme';\n\ninterface Props {\n  turn: ValidatedTurn;\n}\n\nconst Flex = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  justify-content: center;\n`;\n\nconst MutedFlex = styled(Flex)`\n  color: ${({ theme }: { theme: Theme }) => (theme.colors.muted)};\n`;\n\nconst CardBox = styled.div`\n  margin-right: 0.5em;\n  margin-bottom: 0.5em;\n`;\n\nconst Centered = styled.div`\n  text-align: center;\n`;\n\nconst TurnBox = styled.div`\n  margin-right: 1em;\n`;\n\nexport const ErrorBadge = styled(Badge)`\n  background-color: ${({ theme }: { theme: Theme }) => (theme.colors.error)};\n  color: white;\n`;\n\nexport function generateTurnKey(turn: ValidatedTurn): string {\n  return turn.playerId + turn.valid;\n}\n\nfunction Valid({ turn }: { turn: ValidTurn }) {\n  const cardItems = turn.cards.map((card) => (\n    <CardBox key={generateCardKey(card)}>\n      <PlayingCard card={card} />\n    </CardBox>\n  ));\n\n  return (\n    <TurnBox>\n      <Flex>\n        { cardItems }\n      </Flex>\n      <Centered><span>{turn.playerId}</span></Centered>\n    </TurnBox>\n  );\n}\n\nfunction InvalidHiddenAfterTimeout({ turn }: { turn: InvalidTurn }) {\n  const SHOW_INVALID_TURN_TIMEOUT = 2000;\n  const [isVisible, setIsVisible] = useState<boolean>(true);\n  const cardItems = turn.cards.map((card) => (\n    <CardBox key={generateCardKey(card)}>\n      <PlayingCard key={generateCardKey(card)} card={card} />\n    </CardBox>\n  ));\n\n  useEffect(() => {\n    const timeout: number = setTimeout(() => {\n      setIsVisible(false);\n    }, SHOW_INVALID_TURN_TIMEOUT);\n    return () => clearTimeout(timeout);\n  });\n\n  return isVisible\n    ? (\n      <TurnBox>\n        <MutedFlex>\n          { cardItems.length === 0\n            ? <PlayingCardPlaceholder />\n            : cardItems }\n        </MutedFlex>\n        <Centered><span>{turn.playerId}</span></Centered>\n        <Centered>\n          <ErrorBadge>{turn.invalidReason}</ErrorBadge>\n        </Centered>\n      </TurnBox>\n    )\n    : null;\n}\n\nexport default function Turn({ turn }: Props) {\n  return turn.valid\n    ? <Valid turn={turn} />\n    : <InvalidHiddenAfterTimeout turn={turn} />;\n}\n","import React from 'react';\nimport { ValidatedTurn } from 'agurk-shared';\nimport styled from 'styled-components';\nimport Turn, { generateTurnKey } from './Turn';\n\ninterface Props {\n  turns: ValidatedTurn[];\n}\n\nconst Flex = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nexport default function TurnList({ turns }: Props) {\n  const turnItems = turns.map((turn) => (<Turn key={generateTurnKey(turn)} turn={turn} />));\n\n  return (\n    <Flex>\n      { turnItems }\n    </Flex>\n  );\n}\n","import React from 'react';\nimport { compareRanks, ValidatedTurn, ValidTurn } from 'agurk-shared';\nimport styled from 'styled-components';\nimport PlayingCard, { PlayingCardPlaceholder } from './PlayingCard';\nimport { Theme } from './styled/theme';\nimport Badge from './styled/Badge';\nimport TurnList from './TurnList';\n\ninterface Props {\n  playedTurns: ValidatedTurn[];\n}\n\nconst Flex = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nconst Box = styled.div`\n  margin-right: 1em;\n  margin-bottom: 1em;\n`;\n\nexport const SuccessBadge = styled(Badge)`\n  background-color: ${({ theme }: { theme: Theme }) => (theme.colors.success)};\n  color: white;\n`;\n\nconst Centered = styled.div`\n  text-align: center;\n`;\n\nconst CardBox = styled.div`\n  margin-bottom: 0.5em;\n`;\n\nfunction LastPlayedMaxCard({ playedTurns }: Props) {\n  const validTurns = playedTurns.filter((turn) => turn.valid) as ValidTurn[];\n  const playedCards = validTurns.flatMap((turn) => turn.cards);\n  const highestPlayedCard = playedCards.length > 0\n    ? (\n      <PlayingCard card={playedCards.reduce(\n        (maxRankCard, currentCard) => (compareRanks(maxRankCard, currentCard) > 0 ? maxRankCard : currentCard),\n      )}\n      />\n    )\n    : <PlayingCardPlaceholder />;\n\n  return (\n    <>\n      <CardBox>\n        { highestPlayedCard }\n      </CardBox>\n      <Centered>\n        <SuccessBadge>Highest played card</SuccessBadge>\n      </Centered>\n    </>\n  );\n}\n\nexport default function Stack({ playedTurns }: Props) {\n  return (\n    <div>\n      <h2>Stack</h2>\n\n      <Flex>\n        <Box>\n          <LastPlayedMaxCard playedTurns={playedTurns} />\n        </Box>\n        <Box>\n          <TurnList turns={playedTurns} />\n        </Box>\n      </Flex>\n    </div>\n  );\n}\n","import {\n  Card, cardEquals, Error, OutPlayer, Penalty, PlayerId, ValidatedTurn,\n} from 'agurk-shared';\nimport { Action } from 'redux';\n\nexport const SET_PLAYER_ID = 'SET_PLAYER_ID';\nexport const START_GAME = 'START_GAME';\nexport const END_GAME_SUCCESS = 'END_GAME_SUCCESS';\nexport const END_GAME_ERROR = 'END_GAME_ERROR';\nexport const SET_CARDS_IN_HAND = 'SET_CARDS_IN_HAND';\nexport const ADD_PLAYER_TURN = 'ADD_PLAYER_TURN';\nexport const START_ROUND = 'START_ROUND';\nexport const END_ROUND = 'END_ROUND';\nexport const START_CYCLE = 'START_CYCLE';\nexport const END_CYCLE = 'END_CYCLE';\nexport const REQUEST_CARDS = 'REQUEST_CARDS';\nexport const START_PLAYER_TURN = 'START_PLAYER_TURN';\nexport const RESET_GAME = 'RESET_GAME';\n\ninterface SetPlayerIdAction extends Action<typeof SET_PLAYER_ID> {\n  readonly playerId: PlayerId;\n}\n\ninterface StartGameAction extends Action<typeof START_GAME> {\n  readonly playerIds: PlayerId[];\n}\n\ninterface EndGameSuccessAction extends Action<typeof END_GAME_SUCCESS>{\n  readonly winner: PlayerId;\n}\n\ninterface EndGameErrorAction extends Action<typeof END_GAME_ERROR>{\n  readonly error: Error;\n}\n\ninterface SetCardsInHandAction extends Action<typeof SET_CARDS_IN_HAND>{\n  readonly cards: Card[];\n}\n\ninterface StartPlayerTurnAction extends Action<typeof START_PLAYER_TURN>{\n  readonly playerId: PlayerId;\n}\n\ninterface AddPlayerTurnAction extends Action<typeof ADD_PLAYER_TURN>{\n  readonly turn: ValidatedTurn;\n}\n\ninterface StartRoundAction extends Action<typeof START_ROUND>{\n  readonly playerIds: PlayerId[];\n}\n\ninterface EndRoundAction extends Action<typeof END_ROUND>{\n  readonly winner: PlayerId | undefined;\n  readonly penalties: Penalty[];\n  readonly outPlayers: OutPlayer[];\n}\n\ninterface StartCycleAction extends Action<typeof START_CYCLE>{\n  readonly orderedPlayerIds: PlayerId[];\n}\n\ninterface EndCycleAction extends Action<typeof END_CYCLE>{\n  readonly highestTurnPlayerIds: PlayerId[];\n  readonly outPlayers: OutPlayer[];\n}\n\ninterface RequestCardsAction extends Action<typeof REQUEST_CARDS>{\n  readonly turnTimeoutInMillis: number;\n  readonly turnRetriesLeft: number;\n}\n\ninterface ResetGameAction extends Action<typeof RESET_GAME>{}\n\n\nexport type GameAction = StartGameAction | EndGameSuccessAction | EndGameErrorAction | SetCardsInHandAction |\n  AddPlayerTurnAction | StartRoundAction | EndRoundAction | StartCycleAction | EndCycleAction | RequestCardsAction |\n  StartPlayerTurnAction | ResetGameAction | SetPlayerIdAction;\n\nexport function setPlayerId(playerId: string): GameAction {\n  return {\n    type: SET_PLAYER_ID,\n    playerId,\n  };\n}\n\nexport function startGame(playerIds: PlayerId[]): GameAction {\n  return {\n    type: START_GAME,\n    playerIds,\n  };\n}\n\nexport function resetGame(): GameAction {\n  return {\n    type: RESET_GAME,\n  };\n}\n\nexport function endGameError(error: Error): GameAction {\n  return {\n    type: END_GAME_ERROR,\n    error,\n  };\n}\n\nexport function endGameSuccess(winner: PlayerId): GameAction {\n  return {\n    type: END_GAME_SUCCESS,\n    winner,\n  };\n}\n\nexport function setAvailableCardsInHand(cards: Card[]): GameAction {\n  return {\n    type: SET_CARDS_IN_HAND,\n    cards,\n  };\n}\n\nexport function addPlayerTurn(turn: ValidatedTurn): GameAction {\n  return {\n    type: ADD_PLAYER_TURN,\n    turn,\n  };\n}\n\nexport function startPlayerTurn(playerId: PlayerId): GameAction {\n  return {\n    type: START_PLAYER_TURN,\n    playerId,\n  };\n}\n\nexport function startRound(playerIds: PlayerId[]): GameAction {\n  return {\n    type: START_ROUND,\n    playerIds,\n  };\n}\n\nexport function endRound(winner: PlayerId | undefined, penalties: Penalty[], outPlayers: OutPlayer[]): GameAction {\n  return {\n    type: END_ROUND,\n    winner,\n    penalties,\n    outPlayers,\n  };\n}\n\nexport function startCycle(orderedPlayerIds: PlayerId[]): GameAction {\n  return {\n    type: START_CYCLE,\n    orderedPlayerIds,\n  };\n}\n\nexport function endCycle(outPlayers: OutPlayer[], highestTurnPlayerIds: PlayerId[]): GameAction {\n  return {\n    type: END_CYCLE,\n    highestTurnPlayerIds,\n    outPlayers,\n  };\n}\n\nexport function requestCards(turnTimeoutInMillis: number, turnRetriesLeft: number): GameAction {\n  return {\n    type: REQUEST_CARDS,\n    turnTimeoutInMillis,\n    turnRetriesLeft,\n  };\n}\n\nfunction filterPenaltiesForPlayerId(penalties: Penalty[], playerId: PlayerId) {\n  return penalties.filter((penalty) => penalty.playerId === playerId);\n}\n\nfunction isPlayerWithIdOut(outPlayers: OutPlayer[], playerId: PlayerId) {\n  return outPlayers.some((outPlayer) => outPlayer.id === playerId);\n}\n\nfunction isPlayerIdOneOfHighestTurnPlayers(highestTurnPlayerIds: PlayerId[], playerId: PlayerId) {\n  return highestTurnPlayerIds.some((highestTurnPlayerId) => highestTurnPlayerId === playerId);\n}\n\nfunction filterAvailableCardsAfterTurn(cardsInHand: Card[], turn: ValidatedTurn) {\n  return cardsInHand.filter((cardInHand) => turn.cards\n    .find((turnCard) => cardEquals(cardInHand, turnCard)) === undefined);\n}\n\nexport interface PlayerState {\n  id: PlayerId;\n  isGameWinner: boolean;\n  isCycleHighestTurnPlayer: boolean;\n  penalties: Penalty[];\n  isRoundWinner: boolean;\n  isOut: boolean;\n  isServerRequestingCards: boolean;\n}\n\nexport interface ProtocolEntry {\n  message: string;\n}\n\nexport interface State {\n  isRunning: boolean;\n  playerId: PlayerId | undefined;\n  players: PlayerState[];\n  validatedTurns: ValidatedTurn[];\n  cardsInHand: Card[];\n  turnTimeoutInMillis: number | undefined;\n  turnRetriesLeft: number,\n  protocol: ProtocolEntry[],\n}\n\nconst INITIAL_STATE: State = {\n  isRunning: false,\n  playerId: undefined,\n  players: [],\n  validatedTurns: [],\n  cardsInHand: [],\n  turnTimeoutInMillis: undefined,\n  turnRetriesLeft: 0,\n  protocol: [],\n};\n\nconst INITIAL_PLAYER_STATE = {\n  isGameWinner: false,\n  isRoundWinner: false,\n  isCycleHighestTurnPlayer: false,\n  penalties: [],\n  isOut: false,\n  isServerRequestingCards: false,\n};\n\nexport function reducer(state: State = INITIAL_STATE, action: GameAction): State {\n  switch (action.type) {\n    case SET_PLAYER_ID:\n      return {\n        ...state,\n        playerId: action.playerId,\n      };\n    case START_GAME:\n      return {\n        ...state,\n        isRunning: true,\n        players: action.playerIds.map((playerId) => ({\n          ...INITIAL_PLAYER_STATE,\n          id: playerId,\n        })),\n      };\n    case END_GAME_SUCCESS:\n      return {\n        ...state,\n        players: state.players.map((player) => ({\n          ...player,\n          isGameWinner: player.id === action.winner,\n          isServerRequestingCards: false,\n        })),\n        validatedTurns: [],\n        cardsInHand: [],\n        protocol: [\n          {\n            message: `${action.winner} wins the game`,\n          },\n          ...state.protocol,\n        ],\n      };\n    case RESET_GAME:\n      return {\n        ...state,\n        players: state.players.map((player) => ({\n          ...player,\n          ...INITIAL_PLAYER_STATE,\n        })),\n        ...INITIAL_STATE,\n        playerId: state.playerId,\n      };\n    case END_GAME_ERROR:\n      return {\n        ...state,\n        protocol: [\n          {\n            message: `${action.error.message}`,\n          },\n          ...state.protocol,\n        ],\n      };\n    case SET_CARDS_IN_HAND:\n      return {\n        ...state,\n        cardsInHand: action.cards,\n      };\n    case ADD_PLAYER_TURN:\n      return {\n        ...state,\n        validatedTurns: [\n          ...state.validatedTurns,\n          action.turn,\n        ],\n        players: state.players.map((player) => ({\n          ...player,\n          isServerRequestingCards: action.turn.playerId === player.id ? false : player.isServerRequestingCards,\n        })),\n        cardsInHand: (action.turn.playerId === state.playerId && action.turn.valid\n          ? filterAvailableCardsAfterTurn(state.cardsInHand, action.turn)\n          : state.cardsInHand),\n        protocol: action.turn.valid\n          ? [\n            {\n              message: `\n                ${action.turn.playerId} plays\n                ${action.turn.cards.length > 1 ? 'cards' : 'card'}\n                with\n                ${action.turn.cards.length > 1 ? 'ranks' : 'rank'}\n                ${action.turn.cards.map((card) => card.rank).join(', ')}`,\n            },\n            ...state.protocol,\n          ]\n          : state.protocol,\n      };\n    case START_ROUND:\n      return state;\n    case END_ROUND:\n      return {\n        ...state,\n        players: state.players.map((player) => ({\n          ...player,\n          penalties: [\n            ...player.penalties,\n            ...filterPenaltiesForPlayerId(action.penalties, player.id),\n          ],\n          isOut: isPlayerWithIdOut(action.outPlayers, player.id),\n          isRoundWinner: player.id === action.winner,\n        })),\n        protocol: [\n          {\n            message: `${action.winner} wins the current round`,\n          },\n          ...action.penalties.map((penalty) => ({\n            id: new Date().toString() + Math.random(),\n            message: `${penalty.playerId} gets a penalty of ${penalty.card.rank}`,\n          })),\n          ...state.protocol,\n        ],\n      };\n    case START_CYCLE:\n      return {\n        ...state,\n        validatedTurns: [],\n      };\n    case END_CYCLE:\n      return {\n        ...state,\n        players: state.players.map((player) => ({\n          ...player,\n          isCycleHighestTurnPlayer: isPlayerIdOneOfHighestTurnPlayers(action.highestTurnPlayerIds, player.id),\n          isOut: isPlayerWithIdOut(action.outPlayers, player.id),\n        })),\n        protocol: [\n          ...action.highestTurnPlayerIds.map((playerId) => ({\n            message: `${playerId} played the highest card in cycle`,\n          })),\n          ...state.protocol,\n        ],\n      };\n    case REQUEST_CARDS:\n      return {\n        ...state,\n        turnTimeoutInMillis: action.turnTimeoutInMillis,\n        turnRetriesLeft: action.turnRetriesLeft,\n      };\n    case START_PLAYER_TURN:\n      return {\n        ...state,\n        players: state.players.map((player) => ({\n          ...player,\n          isServerRequestingCards: action.playerId === player.id,\n        })),\n      };\n    default:\n      return state;\n  }\n}\n","import React from 'react';\nimport styled from 'styled-components';\nimport { ProtocolEntry } from './redux/game';\n\ninterface Props {\n  entries: ProtocolEntry[];\n}\n\nconst Flex = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  max-height: 25vh;\n`;\n\nexport default function Protocol({ entries }: Props) {\n  const entryItems = entries.map((entry) => <div><span>{entry.message}</span></div>);\n\n  return (\n    <div>\n      <h2>Protocol</h2>\n\n      <Flex>\n        { entryItems }\n      </Flex>\n    </div>\n  );\n}\n","import React, { useEffect } from 'react';\nimport { connect } from 'react-redux';\nimport { Card, ValidatedTurn } from 'agurk-shared';\nimport styled from 'styled-components';\nimport { Action, Dispatch } from 'redux';\nimport Hand from './Hand';\nimport PlayerStateList from './PlayerStateList';\nimport Stack from './Stack';\nimport { State } from './redux';\nimport { WebSocketGameApi } from './communication/webSocketServerApi';\nimport { PlayerState, ProtocolEntry, resetGame } from './redux/game';\nimport Protocol from './Protocol';\n\ninterface Props {\n  state: {\n    players: PlayerState[]\n    playedTurns: ValidatedTurn[];\n    cardsInHand: Card[];\n    playerState: PlayerState;\n    turnTimeoutInMillis: number | undefined;\n    turnRetriesLeft: number;\n    protocolEntries: ProtocolEntry[];\n  };\n  playCards: (cards: Card[]) => void;\n  reset: () => void;\n}\n\nconst Flex = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n`;\n\nconst Box = styled.div`\n  overflow-y: auto;\n  flex-grow: 1;\n  flex-shrink: 0;\n  flex-basis: 300px;\n`;\n\nfunction Game({ state, playCards, reset }: Props) {\n  useEffect(() => reset, [reset]);\n\n  return (\n    <div>\n      <Stack playedTurns={state.playedTurns} />\n      <Hand\n        isServerRequestingCards={state.playerState.isServerRequestingCards}\n        turnTimeoutInMillis={state.turnTimeoutInMillis}\n        turnRetriesLeft={state.turnRetriesLeft}\n        cardsInHand={state.cardsInHand}\n        playCards={playCards}\n      />\n      <Flex>\n        <Box>\n          <PlayerStateList players={state.players} />\n        </Box>\n        <Box>\n          <Protocol entries={state.protocolEntries} />\n        </Box>\n      </Flex>\n    </div>\n  );\n}\n\nconst mapStateToProps = (state: State, ownProps: { serverApi: WebSocketGameApi }) => ({\n  state: {\n    cardsInHand: state.game.cardsInHand,\n    players: state.game.players,\n    playedTurns: state.game.validatedTurns,\n    playerState: state.game.players.find((player) => player.id === state.game.playerId) as PlayerState,\n    playCards: (cards: Card[]) => ownProps.serverApi.sendPlayCards(cards),\n    turnTimeoutInMillis: state.game.turnTimeoutInMillis,\n    turnRetriesLeft: state.game.turnRetriesLeft,\n    protocolEntries: state.game.protocol,\n  },\n  playCards: (cards: Card[]) => ownProps.serverApi.sendPlayCards(cards),\n});\n\n\nconst mapDispatchToProps = (dispatch: Dispatch<Action>) => ({\n  reset: () => dispatch(resetGame()),\n});\n\nexport default connect(mapStateToProps, mapDispatchToProps)(Game);\n","import { PlayerId } from 'agurk-shared';\nimport { Action } from 'redux';\n\nexport const SET_LOBBY_PLAYERS = 'SET_LOBBY_PLAYERS';\n\ninterface SetLobbyPlayersAction extends Action<typeof SET_LOBBY_PLAYERS> {\n  readonly playerIds: PlayerId[];\n}\n\nexport type LobbyAction = SetLobbyPlayersAction;\n\nexport function setLobbyPlayers(playerIds: PlayerId[]): LobbyAction {\n  return {\n    type: SET_LOBBY_PLAYERS,\n    playerIds,\n  };\n}\n\nexport interface State {\n  players: PlayerId[];\n}\n\nconst INITIAL_STATE: State = {\n  players: [],\n};\n\nexport function reducer(state: State = INITIAL_STATE, action: LobbyAction): State {\n  switch (action.type) {\n    case SET_LOBBY_PLAYERS:\n      return {\n        ...state,\n        players: action.playerIds,\n      };\n    default:\n      return state;\n  }\n}\n","import {\n  Card,\n  Message,\n  MessageName,\n} from 'agurk-shared';\nimport { WebSocketSubject } from 'rxjs/webSocket';\nimport { Action } from 'redux';\nimport {\n  addPlayerTurn,\n  endCycle,\n  endGameError,\n  endGameSuccess,\n  endRound,\n  requestCards,\n  resetGame,\n  setAvailableCardsInHand,\n  startCycle,\n  startGame, startPlayerTurn,\n  startRound,\n} from '../redux/game';\nimport { setLobbyPlayers } from '../redux/lobby';\n\nexport interface WebSocketGameApi {\n  sendStartGame: () => void;\n  sendPlayCards: (cards: Card[]) => void;\n}\n\nexport interface WebSocketAuthenticationApi {\n  sendAuthenticate: (token: string) => void;\n}\n\nfunction sendStartGame(subject: WebSocketSubject<Message>): void {\n  return subject.next({ name: MessageName.START_GAME });\n}\n\nfunction sendPlayCards(subject: WebSocketSubject<Message>, cards: Card[]): void {\n  return subject.next({ name: MessageName.PLAY_CARDS, data: cards });\n}\n\nfunction sendAuthenticate(subject: WebSocketSubject<Message>, token: string): void {\n  return subject.next({ name: MessageName.AUTHENTICATE, data: token });\n}\n\nexport function dispatchWebSocketMessageAsActions(message: Message, dispatch: (action: Action) => void) {\n  // eslint-disable-next-line default-case\n  switch (message.name) {\n    case MessageName.BROADCAST_LOBBY_PLAYERS:\n      return dispatch(setLobbyPlayers(message.data));\n    case MessageName.BROADCAST_START_GAME:\n      return dispatch(startGame(message.data.players));\n    case MessageName.BROADCAST_END_GAME:\n      if (message.data.isValid) {\n        dispatch(endGameSuccess(message.data.winner));\n      } else {\n        dispatch(endGameError(message.data.error));\n      }\n      return dispatch(resetGame());\n    case MessageName.BROADCAST_START_ROUND:\n      return dispatch(startRound(message.data.players));\n    case MessageName.BROADCAST_END_ROUND:\n      return dispatch(endRound(message.data.winner, message.data.penalties, message.data.outPlayers));\n    case MessageName.BROADCAST_START_CYCLE:\n      return dispatch(startCycle(message.data.orderedPlayers));\n    case MessageName.BROADCAST_END_CYCLE:\n      return dispatch(endCycle(message.data.outPlayers, message.data.highestTurnPlayers));\n    case MessageName.BROADCAST_PLAYER_TURN:\n      return dispatch(addPlayerTurn(message.data));\n    case MessageName.AVAILABLE_CARDS_IN_HAND:\n      return dispatch(setAvailableCardsInHand(message.data));\n    case MessageName.REQUEST_CARDS:\n      return dispatch(requestCards(message.data.timeoutInMillis, message.data.retriesLeft));\n    case MessageName.BROADCAST_START_PLAYER_TURN:\n      return dispatch(startPlayerTurn(message.data));\n  }\n}\n\nexport function createGameApi(subject: WebSocketSubject<Message>): WebSocketGameApi {\n  return {\n    sendStartGame: sendStartGame.bind(null, subject),\n    sendPlayCards: sendPlayCards.bind(null, subject),\n  };\n}\n\nexport function createAuthenticationApi(subject: WebSocketSubject<Message>): WebSocketAuthenticationApi {\n  return {\n    sendAuthenticate: sendAuthenticate.bind(null, subject),\n  };\n}\n","import React from 'react';\nimport { PlayerId } from 'agurk-shared';\nimport styled from 'styled-components';\n\ninterface Props {\n  playerIds: PlayerId[];\n}\n\nconst Element = styled.li`\n  margin-bottom: 0.5em;\n`;\n\nexport default function PlayerIdList({ playerIds }: Props) {\n  const playerItems = playerIds.map((playerId) => <Element key={playerId}>{playerId}</Element>);\n\n  return (\n    <div>\n      <h2>Players</h2>\n\n      <ul>\n        { playerItems }\n      </ul>\n    </div>\n  );\n}\n","import { Action, Dispatch } from 'redux';\nimport jwtDecode from 'jwt-decode';\nimport { AuthenticationBody, JwtPayload } from 'agurk-shared';\nimport { setPlayerId } from './game';\n\nconst API_SERVER_URI = process.env.REACT_APP_API_SERVER_URI as string;\n\nexport const AUTHENTICATE_WITH_TOKEN = 'AUTHENTICATE_WITH_TOKEN';\nexport const AUTHENTICATION_ERROR = 'AUTHENTICATION_ERROR';\nexport const UNAUTHENTICATE_WITH_ERROR = 'UNAUTHENTICATE_WITH_ERROR';\n\ninterface AuthenticateWithTokenAction extends Action<typeof AUTHENTICATE_WITH_TOKEN>{\n  readonly token: string;\n  readonly subject: string;\n}\n\ninterface AuthenticationError extends Action<typeof AUTHENTICATION_ERROR>{\n  readonly message: string;\n}\n\ninterface UnauthenticateWithErrorAction extends Action<typeof UNAUTHENTICATE_WITH_ERROR>{\n  readonly message: string;\n}\n\nexport type AuthenticationAction = AuthenticateWithTokenAction | AuthenticationError | UnauthenticateWithErrorAction;\n\nexport function authenticateWithToken(token: string, subject: string): AuthenticationAction {\n  return {\n    type: AUTHENTICATE_WITH_TOKEN,\n    token,\n    subject,\n  };\n}\n\nexport function unauthenticateWithError(message: string): AuthenticationAction {\n  return {\n    type: UNAUTHENTICATE_WITH_ERROR,\n    message,\n  };\n}\n\nexport function authenticationError(message: string): AuthenticationAction {\n  return {\n    type: AUTHENTICATION_ERROR,\n    message,\n  };\n}\n\nfunction extractSubjectFromToken(token: string) {\n  return (jwtDecode(token) as JwtPayload).sub;\n}\n\nexport function authenticate(data: AuthenticationBody) {\n  return function postAuthentication(dispatch: Dispatch<Action>) {\n    fetch(`${API_SERVER_URI}/authenticate`, {\n      method: 'POST',\n      mode: 'cors',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(data),\n    })\n      .then(async (response) => {\n        if (response.ok) {\n          const body = await response.json() as { jwt: string };\n          const token = body.jwt;\n          const subject = extractSubjectFromToken(body.jwt);\n          dispatch(authenticateWithToken(token, subject));\n          dispatch(setPlayerId(subject));\n        } else {\n          dispatch(authenticationError('Authentication failed'));\n        }\n      }, () => dispatch(authenticationError('Could not contact server. Try again later...')));\n  };\n}\n\nexport interface State {\n  subject: string;\n  isAuthenticated: boolean,\n  token: string,\n  error: string | undefined,\n}\n\nconst INITIAL_STATE: State = {\n  subject: '',\n  isAuthenticated: false,\n  token: '',\n  error: undefined,\n};\n\nexport function reducer(state: State = INITIAL_STATE, action: AuthenticationAction): State {\n  switch (action.type) {\n    case AUTHENTICATE_WITH_TOKEN:\n      return {\n        ...state,\n        subject: action.subject,\n        isAuthenticated: true,\n        token: action.token,\n        error: undefined,\n      };\n    case AUTHENTICATION_ERROR:\n      return {\n        ...state,\n        error: action.message,\n      };\n    case UNAUTHENTICATE_WITH_ERROR:\n      return {\n        ...state,\n        ...INITIAL_STATE,\n        error: action.message,\n      };\n    default:\n      return state;\n  }\n}\n","import React, { useEffect, useState } from 'react';\nimport { Message, MessageName, PlayerId } from 'agurk-shared';\nimport { connect } from 'react-redux';\nimport { filter } from 'rxjs/operators';\nimport { Action, Dispatch } from 'redux';\nimport { webSocket, WebSocketSubject } from 'rxjs/webSocket';\nimport PrimaryButton from './styled/Button';\nimport Game from './Game';\nimport {\n  createAuthenticationApi, createGameApi, dispatchWebSocketMessageAsActions,\n} from './communication/webSocketServerApi';\nimport { State } from './redux';\nimport PlayerIdList from './PlayerIdList';\nimport { unauthenticateWithError } from './redux/authentication';\n\nconst WSS_SERVER_URI = process.env.REACT_APP_WSS_SERVER_URI as string;\n\ninterface Props {\n  dispatch: Dispatch<Action>;\n  authenticationToken: string;\n  isGameStarted: boolean;\n  players: PlayerId[];\n}\n\nfunction Lobby({\n  dispatch, authenticationToken, isGameStarted, players,\n}: Props) {\n  const [subject] = useState<WebSocketSubject<Message>>(webSocket(WSS_SERVER_URI));\n  const gameApi = createGameApi(subject);\n\n  useEffect(() => {\n    subject.subscribe((message) => dispatchWebSocketMessageAsActions(message, dispatch),\n      () => dispatch(unauthenticateWithError('Could not contact the game server. Try again later...')));\n    return () => subject.complete();\n  }, [subject, dispatch]);\n\n  useEffect(() => {\n    subject.pipe(\n      filter((message) => message.name === MessageName.REQUEST_AUTHENTICATION),\n    ).subscribe(() => {\n      const webSocketAuthenticationApi = createAuthenticationApi(subject);\n      webSocketAuthenticationApi.sendAuthenticate(authenticationToken);\n    });\n    return () => subject.complete();\n  }, [subject, authenticationToken]);\n\n  return (\n    <div className=\"Lobby\">\n      { isGameStarted\n        ? <Game serverApi={gameApi} />\n        : (\n          <>\n            <PlayerIdList playerIds={players} />\n            <PrimaryButton type=\"button\" onClick={gameApi.sendStartGame}>Start Game</PrimaryButton>\n          </>\n        ) }\n    </div>\n  );\n}\n\nconst mapStateToProps = (state: State) => ({\n  isGameStarted: state.game.isRunning,\n  players: state.lobby.players,\n  authenticationToken: state.authentication.token,\n});\n\nexport default connect(mapStateToProps)(Lobby);\n","import React, { FormEvent, useState } from 'react';\nimport { connect } from 'react-redux';\nimport { ThunkDispatch } from 'redux-thunk';\nimport styled from 'styled-components';\nimport PrimaryButton from './styled/Button';\nimport { GameAction } from './redux/game';\nimport { authenticate } from './redux/authentication';\nimport { State } from './redux';\nimport { Theme } from './styled/theme';\n\ninterface Props {\n  dispatch: ThunkDispatch<State, undefined, GameAction>;\n  error: string | undefined;\n}\n\nconst Input = styled.input`\n  padding: 0.5em;\n  width: 100%;\n  height: 3em;\n  margin-bottom: 1em;\n  display: block;\n  font-size: 1em;\n`;\n\nconst SpacedForm = styled.form`\n  margin-bottom: 1em;\n`;\n\nconst ErrorMessage = styled.div`\n  background-color: ${({ theme }: { theme: Theme }) => (theme.colors.error)};\n  padding: 0.5em;\n  width: 100%;\n  color: white;\n  font-weight: bold;\n`;\n\nfunction Login({ dispatch, error }: Props) {\n  const [nameInput, setNameInput] = useState<string>('');\n  const [tokenInput, setTokenInput] = useState<string>('');\n\n  function handleSubmit(event: FormEvent) {\n    dispatch(authenticate({ name: nameInput, token: tokenInput }));\n    event.preventDefault();\n  }\n\n  function handleNameChange(event: FormEvent<HTMLInputElement>) {\n    setNameInput(event.currentTarget.value);\n  }\n\n  function handleTokenChange(event: FormEvent<HTMLInputElement>) {\n    setTokenInput(event.currentTarget.value);\n  }\n\n  return (\n    <>\n      <h2>Login</h2>\n\n      <SpacedForm onSubmit={handleSubmit}>\n        <Input\n          placeholder=\"Player name\"\n          id=\"name\"\n          value={nameInput}\n          onChange={handleNameChange}\n          type=\"text\"\n          name=\"name\"\n          required\n        />\n\n        <Input\n          placeholder=\"Access token\"\n          id=\"token\"\n          value={tokenInput}\n          onChange={handleTokenChange}\n          type=\"password\"\n          name=\"token\"\n          required\n        />\n\n        <PrimaryButton type=\"submit\">Log in</PrimaryButton>\n      </SpacedForm>\n\n      { error && <ErrorMessage>{error}</ErrorMessage>}\n    </>\n  );\n}\n\nconst mapStateToProps = (state: State) => ({\n  error: state.authentication.error,\n});\n\nexport default connect(mapStateToProps)(Login);\n","import React from 'react';\nimport { connect } from 'react-redux';\nimport styled from 'styled-components';\nimport Lobby from './Lobby';\nimport { State } from './redux';\nimport Login from './Login';\nimport { Theme } from './styled/theme';\n\ninterface Props {\n  isAuthenticated: boolean;\n}\n\nconst Container = styled.div`\n  max-width: 800px;\n  margin: auto;\n  padding: 0 2em;\n`;\n\nconst Footer = styled.footer`\n  text-align: center;\n  margin-bottom: 2em;\n`;\n\nconst Main = styled.main`\n  margin-bottom: 2em;\n`;\n\nconst MutedLink = styled.a`\n  color: ${({ theme }: { theme: Theme }) => (theme.colors.muted)};\n  text-decoration: none;\n\n  &:hover {\n    text-decoration: underline;\n  }\n`;\n\nfunction App({ isAuthenticated }: Props) {\n  return (\n    <Container className=\"App\">\n      <header className=\"App-header\">\n        <h1>\n          Agurk\n        </h1>\n      </header>\n      <Main>\n        { isAuthenticated ? <Lobby /> : <Login /> }\n      </Main>\n      <Footer>\n        <MutedLink href=\"https://github.com/SimonMueller/agurk-server#rules\">Read the rules</MutedLink>\n      </Footer>\n    </Container>\n  );\n}\n\nconst mapStateToProps = (state: State) => ({\n  isAuthenticated: state.authentication.isAuthenticated,\n});\n\nexport default connect(mapStateToProps)(App);\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from 'redux';\nimport { reducer as authenticationReducer, State as AuthenticationState } from './authentication';\nimport { reducer as gameReducer, State as GameState } from './game';\nimport { reducer as lobbyReducer, State as LobbyState } from './lobby';\n\nexport interface State {\n  authentication: AuthenticationState;\n  game: GameState;\n  lobby: LobbyState;\n}\n\nexport default combineReducers<State>({\n  authentication: authenticationReducer,\n  game: gameReducer,\n  lobby: lobbyReducer,\n});\n","export interface Theme {\n  colors: {\n    primary: string;\n    muted: string;\n    text: string;\n    error: string;\n    warn: string;\n    success: string;\n  };\n}\n\nconst theme: Theme = {\n  colors: {\n    primary: '#2a52be',\n    muted: '#737373',\n    text: '#000',\n    error: '#ff033e',\n    warn: '#ff4f00',\n    success: 'rgba(0, 140, 0, 0.9)',\n  },\n};\n\nexport default theme;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Provider } from 'react-redux';\nimport { applyMiddleware, createStore } from 'redux';\nimport thunk from 'redux-thunk';\nimport { composeWithDevTools } from 'redux-devtools-extension';\nimport { ThemeProvider } from 'styled-components';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport reducer from './redux/index';\nimport './index.css';\nimport theme from './styled/theme';\n\nconst store = createStore(reducer, composeWithDevTools(applyMiddleware(thunk)));\n\nReactDOM.render(\n  <Provider store={store}>\n    <ThemeProvider theme={theme}>\n      <App />\n    </ThemeProvider>\n  </Provider>,\n  document.getElementById('root'),\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}