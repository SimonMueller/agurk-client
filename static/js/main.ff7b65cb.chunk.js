(this["webpackJsonpagurk-client"]=this["webpackJsonpagurk-client"]||[]).push([[0],{22:function(e,t,a){},24:function(e,t,a){e.exports=a.p+"static/media/logo.25bf045c.svg"},26:function(e,t,a){e.exports=a(43)},31:function(e,t,a){},43:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(14),u=a.n(c),i=(a(31),a(7)),s=a(15),l=a(24),o=a.n(l),d=(a(22),a(9)),m=a(3),p=a(46),E=a(47),f=a(1);function y(e){var t=e.card;return r.a.createElement("div",null,t.kind," ",t.color)}function b(e){var t=e.card;return r.a.createElement("div",null,t.suit," ",t.rank)}function g(e){return e.kind===m.JOKER_CARD_KIND?e.color+e.rank:e.suit+e.rank}function A(e){var t=e.card;return t.kind===m.JOKER_CARD_KIND?r.a.createElement(y,{card:t}):r.a.createElement(b,{card:t})}function T(e){var t=e.cards,a=e.handleSelect,n=t.map((function(e){return r.a.createElement("li",{key:g(e)},r.a.createElement("input",{type:"checkbox",checked:e.isSelected,onChange:function(){return a(e)}}),r.a.createElement(A,{card:e}))}));return r.a.createElement("ul",null,n)}function O(e){var t=e.playSelectedCards;return r.a.createElement("div",null,r.a.createElement("button",{type:"button",onClick:t},"Play Cards"))}function R(e){var t=e.playCards,a=e.cardsInHand,c=e.isServerRequestingCards,u=Object(n.useState)([]),i=Object(d.a)(u,2),s=i[0],l=i[1];return Object(n.useEffect)((function(){var e=a.map((function(e){return Object(f.a)({},e,{isSelected:!1})}));l(e)}),[a]),r.a.createElement("div",null,r.a.createElement("h2",null,"Hand"),r.a.createElement(T,{cards:s,handleSelect:function(e){l(s.map((function(t){return Object(m.cardEquals)(t,e)?Object(f.a)({},t,{isSelected:!t.isSelected}):t})))}}),c&&r.a.createElement(O,{playSelectedCards:function(){var e=s.filter((function(e){return e.isSelected}));t(e)}}))}function v(e){var t=e.player;return r.a.createElement("div",null,r.a.createElement("p",null,t.isServerRequestingCards&&r.a.createElement("span",null,"--\x3e"),t.id))}function S(e){var t=e.players.map((function(e){return r.a.createElement("li",{key:e.id},r.a.createElement(v,{player:e}))}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Players"),r.a.createElement("ul",null,t))}function h(e){var t=e.cards.map((function(e){return r.a.createElement("li",{key:g(e)},r.a.createElement(A,{card:e}))}));return r.a.createElement("ul",null,t)}function _(e){var t=e.playedTurns.filter((function(e){return e.valid})).flatMap((function(e){return e.cards}));return r.a.createElement("div",null,r.a.createElement("h2",null,"Stack"),r.a.createElement(h,{cards:t}))}var j=Object(i.b)((function(e){return{cardsInHand:e.game.cardsInHand,players:e.game.players,playedTurns:e.game.validatedTurns,playerState:e.game.players.find((function(t){return t.id===e.authentication.subject}))}}),(function(e,t){return{playCards:function(e){return t.serverApi.sendPlayCards(e)}}}))((function(e){var t=e.players,a=e.playedTurns,n=e.cardsInHand,c=e.playCards,u=e.playerState;return r.a.createElement("div",null,r.a.createElement(S,{players:t}),r.a.createElement(_,{playedTurns:a}),r.a.createElement(R,{isServerRequestingCards:u.isServerRequestingCards,cardsInHand:n,playCards:c}))}));function C(e){return e.next({name:m.MessageName.START_GAME})}function N(e,t){return e.next({name:m.MessageName.PLAY_CARDS,data:t})}function D(e,t){return e.next({name:m.MessageName.AUTHENTICATE,data:t})}var k=Object(i.b)((function(e){return{isGameStarted:e.game.isRunning,authenticationToken:e.authentication.token}}))((function(e){var t=e.dispatch,a=e.authenticationToken,c=e.isGameStarted,u=Object(n.useState)(Object(E.a)("wss://agurk-server.herokuapp.com")),i=Object(d.a)(u,1)[0],s=function(e){return{sendStartGame:C.bind(null,e),sendPlayCards:N.bind(null,e)}}(i);return Object(n.useEffect)((function(){return i.subscribe((function(e){return function(e,t){switch(e.name){case m.MessageName.BROADCAST_START_GAME:return t({type:"START_GAME",playerIds:e.data.players});case m.MessageName.BROADCAST_END_GAME:return e.data.isValid?t({type:"END_GAME_SUCCESS",winner:e.data.winner}):t({type:"END_GAME_ERROR",error:e.data.error}),t({type:"RESET_GAME"});case m.MessageName.BROADCAST_START_ROUND:return t(function(e){return{type:"START_ROUND",playerIds:e}}(e.data.players));case m.MessageName.BROADCAST_END_ROUND:return t(function(e,t,a){return{type:"END_ROUND",winner:e,penalties:t,outPlayers:a}}(e.data.winner,e.data.penalties,e.data.outPlayers));case m.MessageName.BROADCAST_START_CYCLE:return t({type:"START_CYCLE",orderedPlayerIds:e.data.orderedPlayers});case m.MessageName.BROADCAST_END_CYCLE:return t((a=e.data.outPlayers,{type:"END_CYCLE",highestTurnPlayerIds:e.data.highestTurnPlayers,outPlayers:a}));case m.MessageName.BROADCAST_PLAYER_TURN:return t({type:"ADD_PLAYER_TURN",turn:e.data});case m.MessageName.AVAILABLE_CARDS_IN_HAND:return t({type:"SET_CARDS_IN_HAND",cards:e.data});case m.MessageName.REQUEST_CARDS:return t({type:"REQUEST_CARDS"});case m.MessageName.BROADCAST_START_PLAYER_TURN:return t({type:"START_PLAYER_TURN",playerId:e.data})}var a}(e,t)})),function(){return i.complete()}}),[i,t]),Object(n.useEffect)((function(){return i.pipe(Object(p.a)((function(e){return e.name===m.MessageName.REQUEST_AUTHENTICATION}))).subscribe((function(){(function(e){return{sendAuthenticate:D.bind(null,e)}})(i).sendAuthenticate(a)})),function(){return i.complete()}}),[i,a]),r.a.createElement("div",{className:"Lobby"},r.a.createElement("h1",null,"Agurk"),c?r.a.createElement(j,{serverApi:s}):r.a.createElement("button",{type:"button",onClick:s.sendStartGame},"Start Game"))})),I=a(13),M=a.n(I),P=a(20);var w=Object(i.b)(null,(function(e){return{authenticate:function(t){return e({type:"AUTHENTICATE_WITH_TOKEN",jwt:t})}}}))((function(e){var t=e.authenticate,a=Object(n.useState)(""),c=Object(d.a)(a,2),u=c[0],i=c[1],s=Object(n.useState)(""),l=Object(d.a)(s,2),o=l[0],m=l[1];function p(){return(p=Object(P.a)(M.a.mark((function e(a){return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a.preventDefault(),fetch("".concat("https://agurk-server.herokuapp.com","/authenticate"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:u,token:o})}).then(function(){var e=Object(P.a)(M.a.mark((function e(a){var n;return M.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!a.ok){e.next=5;break}return e.next=3,a.json();case 3:n=e.sent,t(n.jwt);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){return console.log(e)}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return r.a.createElement("div",null,r.a.createElement("h1",null,"Home"),r.a.createElement("form",{onSubmit:function(e){return p.apply(this,arguments)}},r.a.createElement("label",{htmlFor:"name"},"Player name:",r.a.createElement("input",{id:"name",value:u,onChange:function(e){i(e.currentTarget.value)},type:"text",name:"name"})),r.a.createElement("label",{htmlFor:"token"},"Access token",r.a.createElement("input",{id:"token",value:o,onChange:function(e){m(e.currentTarget.value)},type:"text",name:"token"})),r.a.createElement("input",{type:"submit",value:"Submit"})))}));var H=Object(i.b)((function(e){return{isAuthenticated:e.authentication.isAuthenticated}}))((function(e){var t=e.isAuthenticated;return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:o.a,className:"App-logo",alt:"logo"})),r.a.createElement("main",null,t?r.a.createElement(k,null):r.a.createElement(w,null)))}));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var U=a(16),G=a(25),L=a.n(G),x={authentication:{subject:"",isAuthenticated:!1,token:""},game:{isRunning:!1,players:[],validatedTurns:[],cardsInHand:[]}},Y={isGameWinner:!1,isRoundWinner:!1,isCycleHighestTurnPlayer:!1,penalties:[],isOut:!1,isServerRequestingCards:!1};function B(e,t){return e.filter((function(e){return e.playerId===t}))}function q(e,t){return e.some((function(e){return e.id===t}))}function W(e,t){return e.some((function(e){return e===t}))}function K(e,t){return e.filter((function(e){return void 0===t.cards.find((function(t){return Object(m.cardEquals)(e,t)}))}))}var J=Object(s.b)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:x,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"START_GAME":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{isRunning:!0,players:t.playerIds.map((function(e){return Object(f.a)({},Y,{id:e})}))})});case"END_GAME_SUCCESS":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{players:e.game.players.map((function(e){return Object(f.a)({},e,{isGameWinner:e.id===t.winner,isServerRequestingCards:!1})})),validatedTurns:[],cardsInHand:[]})});case"RESET_GAME":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{validatedTurns:[],players:e.game.players.map((function(e){return Object(f.a)({},e,{isServerRequestingCards:!1})})),cardsInHand:[],isRunning:!1})});case"END_GAME_ERROR":return e;case"SET_CARDS_IN_HAND":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{cardsInHand:t.cards})});case"ADD_PLAYER_TURN":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{validatedTurns:[].concat(Object(U.a)(e.game.validatedTurns),[t.turn]),cardsInHand:t.turn.playerId===e.authentication.subject&&t.turn.valid?K(e.game.cardsInHand,t.turn):e.game.cardsInHand})});case"START_ROUND":return e;case"END_ROUND":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{players:e.game.players.map((function(e){return Object(f.a)({},e,{penalties:[].concat(Object(U.a)(e.penalties),Object(U.a)(B(t.penalties,e.id))),isOut:q(t.outPlayers,e.id),isRoundWinner:e.id===t.winner})}))})});case"START_CYCLE":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{validatedTurns:[]})});case"END_CYCLE":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{players:e.game.players.map((function(e){return Object(f.a)({},e,{isCycleHighestTurnPlayer:W(t.highestTurnPlayerIds,e.id),isOut:q(t.outPlayers,e.id)})}))})});case"REQUEST_CARDS":return e;case"AUTHENTICATE_WITH_TOKEN":return Object(f.a)({},e,{authentication:{subject:L()(t.jwt).sub,isAuthenticated:!0,token:t.jwt}});case"START_PLAYER_TURN":return Object(f.a)({},e,{game:Object(f.a)({},e.game,{players:e.game.players.map((function(e){return Object(f.a)({},e,{isServerRequestingCards:t.playerId===e.id})}))})});default:return e}}));u.a.render(r.a.createElement(i.a,{store:J},r.a.createElement(H,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[26,1,2]]]);
//# sourceMappingURL=main.ff7b65cb.chunk.js.map